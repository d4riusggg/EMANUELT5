<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8">
  <title>Admin - Istoric SusÈ›inÄƒtori</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Inter', sans-serif;
      background: #f5f7fa;
      margin: 0;
      padding: 20px;
    }
    .card {
      background: white;
      padding: 20px;
      border-radius: 10px;
      max-width: 800px;
      margin: auto;
      box-shadow: 0 4px 10px rgba(0, 0, 0, 0.1);
    }
    h2 { text-align: center; }
    input, select, button {
      padding: 10px;
      margin: 10px 0;
      width: 100%;
      border: 1px solid #ccc;
      border-radius: 6px;
      font-size: 16px;
    }
    button {
      background: #2196F3;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover { background: #0b7dda; }
    .entry {
      padding: 10px;
      margin: 10px 0;
      background: #f1f1f1;
      border-radius: 6px;
    }
    .entry span {
      display: inline-block;
      width: 22%;
      text-align: center;
    }
    .danger {
      background: #f44336;
    }
    .danger:hover {
      background: #d32f2f;
    }
  </style>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-database-compat.js"></script>
</head>
<body>
  <div class="card">
    <h2>ğŸ” Admin - Istoric SusÈ›inÄƒtori</h2>
    <input type="password" id="parola-input" placeholder="Introdu parola">
    <button onclick="login()">Logare</button>

    <div id="admin-panel" style="display:none;">
      <h3>ğŸ§¾ AdaugÄƒ Ã®nregistrare</h3>
      <input type="text" id="nume" placeholder="Nume susÈ›inÄƒtor">
      <input type="number" id="valoare" placeholder="Puncte">
      <select id="tip">
        <option value="shop">Shop</option>
        <option value="gift">Gift</option>
      </select>
      <button onclick="adaugaInregistrare()">AdaugÄƒ</button>

      <h3>ğŸ“‹ Istoric ÃnregistrÄƒri</h3>
      <div id="istoric"></div>
    </div>
  </div>

  <script>
    const config = {
      apiKey: "AIzaSyBHx0H0eeJFYDpp4nHvivdvY3o_81YY_SU",
      authDomain: "emanuelt5.firebaseapp.com",
      projectId: "emanuelt5",
      databaseURL: "https://emanuelt5-defadefault-rtdb.europe-west1.firebasedatabase.app/"
    };
    firebase.initializeApp(config);
    const db = firebase.database();

    function login() {
      const parola = document.getElementById('parola-input').value;
      db.ref('admin/parola').once('value').then(snap => {
        if (parola === snap.val()) {
          document.getElementById('parola-input').style.display = 'none';
          document.querySelector('button').style.display = 'none';
          document.getElementById('admin-panel').style.display = 'block';
          incarcaDate();
        } else {
          alert('Parola greÈ™itÄƒ');
        }
      });
    }

    function adaugaInregistrare() {
      let nume = document.getElementById('nume').value.trim();
      if (!nume) nume = document.getElementById('select-nume').value;
      const valoare = parseInt(document.getElementById('valoare').value);
      const tip = document.getElementById('tip').value;
      const data = new Date().toISOString().split('T')[0];
      if (!nume || isNaN(valoare)) return alert('Completare invalidÄƒ');

      const inregistrare = { nume, valoare, tip, data };
      const nou = db.ref('istoric').push();
      nou.set(inregistrare);
    }

    function incarcaDate() {
      db.ref('istoric').on('value', snap => {
        const container = document.getElementById('istoric');
        container.innerHTML = '';
        const valori = snap.val() || {};
        Object.entries(valori).forEach(([key, val]) => {
          const div = document.createElement('div');
          div.className = 'entry';
          div.innerHTML = `
            <span><strong>${val.nume}</strong></span>
            <span>${val.valoare}</span>
            <span>${val.tip}</span>
            <span>${val.data}</span>
            <button class="danger" onclick="sterge('${key}')">È˜terge</button>
          `;
          container.appendChild(div);
        });
      });

      db.ref('sustinatori').once('value').then(snap => {
        const select = document.getElementById('select-nume');
        select.innerHTML = '<option value="">Alege susÈ›inÄƒtor existent</option>';
        Object.keys(snap.val() || {}).forEach(nume => {
          const opt = document.createElement('option');
          opt.value = nume;
          opt.textContent = nume;
          select.appendChild(opt);
        });
      });
    }

    function sterge(id) {
      if (confirm('Sigur?')) db.ref('istoric/' + id).remove();
    }
  </script>
</body>
</html>